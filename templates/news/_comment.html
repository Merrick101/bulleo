{% load i18n static %}
{% with indent_value=level|default:"0" %}
<div class="comment mb-3 comment-indent-{{ indent_value }}" id="comment-{{ comment.id }}"
  data-comment-id="{{ comment.id }}" data-level="{{ indent_value }}">
  <div class="comment-header">
    <p>
      <strong>{{ comment.user.username }}</strong>
      <small>{{ comment.created_at|date:"F d, Y H:i" }}</small>
    </p>
  </div>
  <div class="comment-body">
    <p>{{ comment.content }}</p>
    {# Show placeholder if this is a nested reply and its parent is missing #}
    {% if level and level != "0" and not comment.parent %}
    <div class="deleted-parent-msg">Original comment deleted</div>
    {% endif %}
  </div>
  {% if user.is_authenticated %}
  <div class="comment-actions">
    <button class="btn btn-sm btn-outline-success vote-btn" data-action="upvote"
      data-comment-id="{{ comment.id }}">👍</button>
    <span class="upvote-count" id="upvote-count-{{ comment.id }}">{{ comment.upvote_count }}</span>
    <button class="btn btn-sm btn-outline-danger vote-btn" data-action="downvote"
      data-comment-id="{{ comment.id }}">👎</button>
    <span class="downvote-count" id="downvote-count-{{ comment.id }}">{{ comment.downvote_count }}</span>
    <button class="btn btn-sm btn-outline-primary reply-btn" data-parent-id="{{ comment.id }}">Reply</button>
    {% if comment.user == user %}
    <button class="btn btn-sm btn-outline-warning edit-btn" data-comment-id="{{ comment.id }}">Edit</button>
    <button class="btn btn-sm btn-outline-danger delete-btn" data-comment-id="{{ comment.id }}">Delete</button>
    {% else %}
    <button class="btn btn-sm btn-outline-danger report-btn" data-comment-id="{{ comment.id }}">Report</button>
    {% endif %}
  </div>
  {% endif %}
  <!-- Render Replies Recursively -->
  <div class="replies">
    {% for reply in comment.replies.all %}
    {% with new_level=indent_value|add:"20" %}
    {% include "news/_comment.html" with comment=reply level=new_level %}
    {% endwith %}
    {% endfor %}
  </div>
</div>
{% endwith %}
